<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>gltfloader</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            /* éšè—bodyçª—å£åŒºåŸŸæ»šåŠ¨æ¡ */
        }
    </style>
    <!--å¼•å…¥three.jsä¸‰ç»´å¼•æ“-->
    <!-- <script src="http://www.yanhuangxueyuan.com/versions/threejsR92/build/three.js"></script> -->
    <!-- <script src="http://www.yanhuangxueyuan.com/threejs/build/three.js"></script> -->
    <!-- æœ€æ–°çš„æ’ä»¶è¦å’Œæœ€æ–°çš„threeåŒ¹é… -->
    <script src="../three.js"></script>
    <script src="../OrbitControls.js"></script>
    <script src="./GLTFLoader.js"></script>
    <script src="./DRACOLoader.js"></script>
</head>

<body>
    <script>
        let scene, renderer, camera;
        let model, skeleton, mixer, clock;
        let breakDanceAction;

        const container = document.body;
        camera = new THREE.PerspectiveCamera( 45, window.innerWidth / window.innerHeight, 1, 1000 );
        camera.position.set( 1, 2, - 3 );
        camera.lookAt( 0, 1, 0 );

        clock = new THREE.Clock();

        scene = new THREE.Scene();
        scene.background = new THREE.Color( 0xa0a0a0 );
        scene.fog = new THREE.Fog( 0xa0a0a0, 10, 50 );

        const dirLight = new THREE.DirectionalLight( 0xffffff );
        dirLight.position.set( - 3, 10, - 10 );
        dirLight.castShadow = true;
        dirLight.shadow.camera.top = 2;
        dirLight.shadow.camera.bottom = - 2;
        dirLight.shadow.camera.left = - 2;
        dirLight.shadow.camera.right = 2;
        dirLight.shadow.camera.near = 0.1;
        dirLight.shadow.camera.far = 40;
        scene.add( dirLight );

        // åŠ è½½ gltfã€glbæ¨¡å‹
        const loader = new THREE.GLTFLoader();
        const dracoLoader = new THREE.DRACOLoader();
        dracoLoader.setDecoderPath('./draco/');
        loader.setDRACOLoader(dracoLoader);
        loader.load('./å€’ç«‹freeze-processed.glb', (gltf) => {
            console.log("ğŸš€gltf", gltf)
            model = gltf.scene;
            // model.position.set(10, 0, 0);
            scene.add( model );
            model.traverse( ( object ) => {
                if ( object.isMesh ) object.castShadow = true;
            } );
            skeleton = new THREE.SkeletonHelper( model );
            skeleton.visible = false;
            scene.add( skeleton );
            const animations = gltf.animations;
            mixer = new THREE.AnimationMixer( model );
            breakDanceAction = mixer.clipAction( animations[ 0 ] );
            breakDanceAction.play();
            render();
        });

        renderer = new THREE.WebGLRenderer( { antialias: true } );
        renderer.setSize( window.innerWidth, window.innerHeight );
        renderer.outputEncoding = THREE.sRGBEncoding;
        // renderer.shadowMap.enabled = true;
        container.appendChild( renderer.domElement );

        function render() {
            requestAnimationFrame(render); //è¯·æ±‚å†æ¬¡æ‰§è¡Œæ¸²æŸ“å‡½æ•°render
            let mixerUpdateDelta = clock.getDelta();
            mixer.update( mixerUpdateDelta );
            renderer.render(scene, camera); //æ‰§è¡Œæ¸²æŸ“æ“ä½œ
        }

        // é€šè¿‡å¼•å…¥OrbitControls.jsæ§ä»¶å®ç°ï¼Œç›®å½• examples\js\controls
        var controls = new THREE.OrbitControls(camera, renderer.domElement); //åˆ›å»ºæ§ä»¶å¯¹è±¡

         // è¾…åŠ©åæ ‡ç³»  å‚æ•°250è¡¨ç¤ºåæ ‡ç³»å¤§å°ï¼Œå¯ä»¥æ ¹æ®åœºæ™¯å¤§å°å»è®¾ç½®
        // X:Hçº¢çº¿ï¼›Y:ç»¿çº¿ï¼›Zï¼šè“çº¿
        var axisHelper = new THREE.AxesHelper(250);
        scene.add(axisHelper);
    </script>
</body>

</html>